<!DOCTYPE html>
<html>
<head>
  <title>Temperature Widget</title>
</head>
<body>
  <div id="temperature-widget">
    Temperature: <span id="temperature-value">N/A</span> Â°F
  </div>

  <script>
    const accessToken = '3b35536d-6dea-4d8c-bf74-85dba517c2ba';
    const deviceID = 248928;
    const socket = new WebSocket(`wss://ws.weatherflow.com/swd/data?token=${accessToken}`);
    const temperatureElement = document.getElementById('temperature-value');

    socket.onopen = () => {
      const listenStartMessage = {
        type: 'listen_start',
        device_id: deviceID,
        id: 'listen_start_id'
      };
      socket.send(JSON.stringify(listenStartMessage));
      console.log('WebSocket connection open.');
    };

    socket.onmessage = (event) => {
  const message = JSON.parse(event.data);
  switch (message.type) {
    case 'obs_air':
      const temperature = message.obs[0].air_temperature;
      temperatureElement.textContent = temperature.toFixed(2); // Display temperature with 2 decimal places
      break;
    case 'ack':
      console.log('Acknowledgement received.');
      break;
    // Add more cases for other message types if needed
    default:
      // Handle unknown message types here
  }
};

    socket.onclose = () => {
      console.log('WebSocket connection closed.');
    };

    socket.onerror = (error) => {
      console.error('WebSocket error:', error);
    };

    window.onbeforeunload = () => {
      const listenStopMessage = {
        type: 'listen_stop',
        device_id: deviceID,
        id: 'listen_stop_id'
      };
      socket.send(JSON.stringify(listenStopMessage));
    };
  </script>
</body>
</html>
